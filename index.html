<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบบันทึกผลการเรียน - LocalStorage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>body { font-family: 'Kanit', sans-serif; }</style>
</head>
<body class="bg-slate-50 min-h-screen p-4">

    <div id="login-box" class="max-w-md mx-auto mt-20 bg-white p-8 rounded-2xl shadow-lg">
        <h1 class="text-2xl font-bold text-center mb-6">เข้าสู่ระบบนักศึกษา</h1>
        <input type="text" id="student-id" placeholder="กรอกรหัสนักศึกษาของคุณ" class="w-full p-3 border rounded-lg mb-4 outline-none focus:ring-2 focus:ring-blue-500">
        <button onclick="login()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700">เข้าสู่ระบบ</button>
    </div>

    <div id="main-content" class="hidden max-w-4xl mx-auto">
        <div class="bg-white p-6 rounded-2xl shadow-md mb-6 flex justify-between items-center">
            <div>
                <h2 class="text-xl font-bold" id="user-display">รหัส: </h2>
                <p class="text-blue-600">สถานะ: กำลังบันทึกข้อมูลลงในเครื่องนี้</p>
            </div>
            <button onclick="location.reload()" class="text-red-500 font-bold">ออกจากระบบ</button>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-md mb-6">
            <div class="flex justify-between mb-2">
                <span class="font-bold">ความคืบหน้าหลักสูตร</span>
                <span id="progress-text" class="font-bold text-blue-600">0%</span>
            </div>
            <div class="w-full bg-slate-200 h-4 rounded-full overflow-hidden">
                <div id="progress-bar" class="bg-blue-600 h-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-md overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-slate-100">
                    <tr>
                        <th class="p-4">รหัสวิชา</th>
                        <th class="p-4">ชื่อวิชา</th>
                        <th class="p-4 w-32">เกรด</th>
                    </tr>
                </thead>
                <tbody id="course-list">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        // 1. รายชื่อวิชาทั้งหมดในหลักสูตร (คุณสามารถเพิ่มลดตรงนี้ได้เลย)
        const allCourses = [
            { id: "GE101", name: "ภาษาไทยเพื่อการสื่อสาร" },
            { id: "GE102", name: "ภาษาอังกฤษพื้นฐาน" },
            { id: "CS101", name: "พื้นฐานคอมพิวเตอร์และเทคโนโลยี" },
            { id: "CS102", name: "การเขียนโปรแกรมเบื้องต้น" },
            { id: "MA101", name: "แคลคูลัส 1" },
            { id: "MA102", name: "สถิติเบื้องต้น" }
        ];

        let currentUserId = "";

        function login() {
            const idInput = document.getElementById('student-id').value;
            if (!idInput) return alert("กรุณากรอกรหัส");
            
            currentUserId = idInput;
            document.getElementById('login-box').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            document.getElementById('user-display').innerText = "รหัสประจำตัว: " + currentUserId;
            
            loadAndRender();
        }

        // 2. ฟังก์ชันแสดงผลและโหลดเกรดจากเครื่อง
        function loadAndRender() {
            // ดึงเกรดที่เคยบันทึกไว้ในเครื่อง (ถ้ามี)
            const savedGrades = JSON.parse(localStorage.getItem('grades_' + currentUserId)) || {};
            const listContainer = document.getElementById('course-list');
            listContainer.innerHTML = "";
            
            let passedCount = 0;

            allCourses.forEach(course => {
                const currentGrade = savedGrades[course.id] || "";
                if (currentGrade !== "" && currentGrade !== "F" && currentGrade !== "W") {
                    passedCount++;
                }

                listContainer.innerHTML += `
                    <tr class="border-b">
                        <td class="p-4 font-mono text-sm">${course.id}</td>
                        <td class="p-4">${course.name}</td>
                        <td class="p-4">
                            <select onchange="saveGrade('${course.id}', this.value)" class="w-full p-2 border rounded bg-white">
                                <option value="">-</option>
                                <option value="A" ${currentGrade === 'A' ? 'selected' : ''}>A</option>
                                <option value="B+" ${currentGrade === 'B+' ? 'selected' : ''}>B+</option>
                                <option value="B" ${currentGrade === 'B' ? 'selected' : ''}>B</option>
                                <option value="C+" ${currentGrade === 'C+' ? 'selected' : ''}>C+</option>
                                <option value="C" ${currentGrade === 'C' ? 'selected' : ''}>C</option>
                                <option value="D+" ${currentGrade === 'D+' ? 'selected' : ''}>D+</option>
                                <option value="D" ${currentGrade === 'D' ? 'selected' : ''}>D</option>
                                <option value="F" ${currentGrade === 'F' ? 'selected' : ''}>F</option>
                                <option value="W" ${currentGrade === 'W' ? 'selected' : ''}>W</option>
                            </select>
                        </td>
                    </tr>
                `;
            });

            // อัปเดต Progress Bar
            const percent = Math.round((passedCount / allCourses.length) * 100);
            document.getElementById('progress-bar').style.width = percent + "%";
            document.getElementById('progress-text').innerText = percent + "%";
        }

        // 3. ฟังก์ชันบันทึกเกรดลงเครื่อง
        function saveGrade(courseId, grade) {
            const savedGrades = JSON.parse(localStorage.getItem('grades_' + currentUserId)) || {};
            savedGrades[courseId] = grade;
            localStorage.setItem('grades_' + currentUserId, JSON.stringify(savedGrades));
            
            // โหลดหน้าใหม่เพื่ออัปเดตเปอร์เซ็นต์
            loadAndRender();
        }
    </script>
</body>
</html>
